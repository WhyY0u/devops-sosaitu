import{G as u,j as t,r as l,a as g,o as V,p as G,q as H,s as v,t as A}from"./index-C6-jK34F.js";function X(s){return u({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeMiterlimit:"10",strokeWidth:"32",d:"M416.07 272a160 160 0 1 0-160 160 160 160 0 0 0 160-160zM142.12 91.21A46.67 46.67 0 0 0 112 80l-2.79.08C83.66 81.62 64 104 64.07 131c0 13.21 4.66 19.37 10.88 27.23a4.55 4.55 0 0 0 3.24 1.77h.88a3.23 3.23 0 0 0 2.54-1.31L142.38 99a5.38 5.38 0 0 0 1.55-4 5.26 5.26 0 0 0-1.81-3.79zm227.76 0A46.67 46.67 0 0 1 400 80l2.79.08C428.34 81.62 448 104 447.93 131c0 13.21-4.66 19.37-10.88 27.23a4.55 4.55 0 0 1-3.24 1.76h-.88a3.23 3.23 0 0 1-2.54-1.31L369.62 99a5.38 5.38 0 0 1-1.55-4 5.26 5.26 0 0 1 1.81-3.79z"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256.07 160v112h-80m240 160-40-40m-280 40 40-40"},child:[]}]})(s)}function J(s){return u({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M262.29 192.31a64 64 0 1 0 57.4 57.4 64.13 64.13 0 0 0-57.4-57.4zM416.39 256a154.34 154.34 0 0 1-1.53 20.79l45.21 35.46a10.81 10.81 0 0 1 2.45 13.75l-42.77 74a10.81 10.81 0 0 1-13.14 4.59l-44.9-18.08a16.11 16.11 0 0 0-15.17 1.75A164.48 164.48 0 0 1 325 400.8a15.94 15.94 0 0 0-8.82 12.14l-6.73 47.89a11.08 11.08 0 0 1-10.68 9.17h-85.54a11.11 11.11 0 0 1-10.69-8.87l-6.72-47.82a16.07 16.07 0 0 0-9-12.22 155.3 155.3 0 0 1-21.46-12.57 16 16 0 0 0-15.11-1.71l-44.89 18.07a10.81 10.81 0 0 1-13.14-4.58l-42.77-74a10.8 10.8 0 0 1 2.45-13.75l38.21-30a16.05 16.05 0 0 0 6-14.08c-.36-4.17-.58-8.33-.58-12.5s.21-8.27.58-12.35a16 16 0 0 0-6.07-13.94l-38.19-30A10.81 10.81 0 0 1 49.48 186l42.77-74a10.81 10.81 0 0 1 13.14-4.59l44.9 18.08a16.11 16.11 0 0 0 15.17-1.75A164.48 164.48 0 0 1 187 111.2a15.94 15.94 0 0 0 8.82-12.14l6.73-47.89A11.08 11.08 0 0 1 213.23 42h85.54a11.11 11.11 0 0 1 10.69 8.87l6.72 47.82a16.07 16.07 0 0 0 9 12.22 155.3 155.3 0 0 1 21.46 12.57 16 16 0 0 0 15.11 1.71l44.89-18.07a10.81 10.81 0 0 1 13.14 4.58l42.77 74a10.8 10.8 0 0 1-2.45 13.75l-38.21 30a16.05 16.05 0 0 0-6.05 14.08c.33 4.14.55 8.3.55 12.47z"},child:[]}]})(s)}function K(s){return u({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeMiterlimit:"10",strokeWidth:"32",d:"M366.05 146a46.7 46.7 0 0 1-2.42-63.42 3.87 3.87 0 0 0-.22-5.26l-44.13-44.18a3.89 3.89 0 0 0-5.5 0l-70.34 70.34a23.62 23.62 0 0 0-5.71 9.24 23.66 23.66 0 0 1-14.95 15 23.7 23.7 0 0 0-9.25 5.71L33.14 313.78a3.89 3.89 0 0 0 0 5.5l44.13 44.13a3.87 3.87 0 0 0 5.26.22 46.69 46.69 0 0 1 65.84 65.84 3.87 3.87 0 0 0 .22 5.26l44.13 44.13a3.89 3.89 0 0 0 5.5 0l180.4-180.39a23.7 23.7 0 0 0 5.71-9.25 23.66 23.66 0 0 1 14.95-15 23.62 23.62 0 0 0 9.24-5.71l70.34-70.34a3.89 3.89 0 0 0 0-5.5l-44.13-44.13a3.87 3.87 0 0 0-5.26-.22 46.7 46.7 0 0 1-63.42-2.32z"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"m250.5 140.44-16.51-16.51m60.53 60.53-11.01-11m55.03 55.03-11-11.01m60.53 60.53-16.51-16.51"},child:[]}]})(s)}const Q="_ticketStat_jf3yd_1",Z="_topRow_jf3yd_12",q="_iconWrapper_jf3yd_20",tt="_count_jf3yd_28",et="_label_jf3yd_36",h={ticketStat:Q,topRow:Z,iconWrapper:q,count:tt,label:et},x=({icon:s,label:a,count:n})=>t.jsxs("div",{className:h.ticketStat,children:[t.jsxs("div",{className:h.topRow,children:[t.jsx("div",{className:h.iconWrapper,children:s}),t.jsx("p",{className:h.count,children:n})]}),t.jsx("p",{className:h.label,children:a})]});function st(s){return u({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M362.6 192.9L345 174.8c-.7-.8-1.8-1.2-2.8-1.2-1.1 0-2.1.4-2.8 1.2l-122 122.9-44.4-44.4c-.8-.8-1.8-1.2-2.8-1.2-1 0-2 .4-2.8 1.2l-17.8 17.8c-1.6 1.6-1.6 4.1 0 5.7l56 56c3.6 3.6 8 5.7 11.7 5.7 5.3 0 9.9-3.9 11.6-5.5h.1l133.7-134.4c1.4-1.7 1.4-4.2-.1-5.7z"},child:[]},{tag:"path",attr:{d:"M256 76c48.1 0 93.3 18.7 127.3 52.7S436 207.9 436 256s-18.7 93.3-52.7 127.3S304.1 436 256 436c-48.1 0-93.3-18.7-127.3-52.7S76 304.1 76 256s18.7-93.3 52.7-127.3S207.9 76 256 76m0-28C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z"},child:[]}]})(s)}function at(s){return u({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M235.4 172.2c0-11.4 9.3-19.9 20.5-19.9 11.4 0 20.7 8.5 20.7 19.9s-9.3 20-20.7 20c-11.2 0-20.5-8.6-20.5-20zm1.4 35.7H275V352h-38.2V207.9z"},child:[]},{tag:"path",attr:{d:"M256 76c48.1 0 93.3 18.7 127.3 52.7S436 207.9 436 256s-18.7 93.3-52.7 127.3S304.1 436 256 436c-48.1 0-93.3-18.7-127.3-52.7S76 304.1 76 256s18.7-93.3 52.7-127.3S207.9 76 256 76m0-28C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z"},child:[]}]})(s)}const ct="_container_ticket_wtj3m_1",nt={container_ticket:ct},Qt=({counts:s})=>t.jsxs("div",{className:`${nt.container_ticket}`,children:[t.jsx(x,{icon:t.jsx(K,{style:{color:"#6065fa",fontSize:"28px"}}),label:"Всего тикетов",count:s.all}),t.jsx(x,{icon:t.jsx(at,{style:{color:"#3b82f6",fontSize:"28px"}}),label:"Новые",count:s.new}),t.jsx(x,{icon:t.jsx(X,{style:{color:"#f97316",fontSize:"28px"}}),label:"В работе",count:s.inProgress}),t.jsx(x,{icon:t.jsx(st,{style:{color:"#22c55e",fontSize:"28px"}}),label:"Закрыте",count:s.inProgress})]}),y={Expectation:"Expectation",InProgress:"InProgress",Completed:"Completed"},it="_ticket_list_container_5mrao_1",ot={ticket_list_container:it},lt="_ticket_container_1w21o_1",rt="_ticket_line_one_1w21o_11",_t="_ticket_number_1w21o_16",mt="_ticket_status_name_1w21o_30",dt="_user_icon_1w21o_43",ut="_ticket_name_1w21o_50",pt="_display_1w21o_57",ht="_ticket_creator_name_1w21o_61",kt="_ticket_icon_create_data_1w21o_67",xt="_ticket_create_data_1w21o_75",gt="_ticket_type_1w21o_81",jt="_ticket_type_settings_1w21o_87",ft="_description_text_1w21o_95",wt="_button_1w21o_103",bt="_button_icon_1w21o_117",Nt="_input_wrapper_1w21o_121",St="_input_with_icon_1w21o_129",vt="_message_input_1w21o_134",yt="_ticket_margin_1w21o_179",Ct="_cancel_text_1w21o_185",$t="_send_message_1w21o_186",Tt="_ai_comment_block_1w21o_224",zt="_ai_comment_header_1w21o_234",Mt="_ai_icon_1w21o_241",Rt="_ai_title_1w21o_246",Ft="_ai_comment_text_1w21o_252",It="_expand_button_1w21o_258",e={ticket_container:lt,ticket_line_one:rt,ticket_number:_t,ticket_status_name:mt,user_icon:dt,ticket_name:ut,display:pt,ticket_creator_name:ht,ticket_icon_create_data:kt,ticket_create_data:xt,ticket_type:gt,ticket_type_settings:jt,description_text:ft,button:wt,button_icon:bt,input_wrapper:Nt,input_with_icon:St,message_input:vt,ticket_margin:yt,cancel_text:Ct,send_message:$t,ai_comment_block:Tt,ai_comment_header:zt,ai_icon:Mt,ai_title:Rt,ai_comment_text:Ft,expand_button:It},Lt="_status_container_1po23_1",At="_current_status_1po23_6",Bt="_status_list_1po23_13",Et="_status_item_1po23_19",Wt="_image_icon_1po23_35",Dt="_status_item_selected_1po23_38",d={status_container:Lt,current_status:At,status_list:Bt,status_item:Et,image_icon:Wt,status_item_selected:Dt};function Pt(s){return u({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"},child:[]},{tag:"path",attr:{d:"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"},child:[]}]})(s)}function Yt(s){return u({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"},child:[]},{tag:"path",attr:{d:"M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"},child:[]}]})(s)}function Ot(s){return u({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M9.172 16.242 12 13.414l2.828 2.828 1.414-1.414L13.414 12l2.828-2.828-1.414-1.414L12 10.586 9.172 7.758 7.758 9.172 10.586 12l-2.828 2.828z"},child:[]},{tag:"path",attr:{d:"M12 22c5.514 0 10-4.486 10-10S17.514 2 12 2 2 6.486 2 12s4.486 10 10 10zm0-18c4.411 0 8 3.589 8 8s-3.589 8-8 8-8-3.589-8-8 3.589-8 8-8z"},child:[]}]})(s)}const B=[{value:y.Expectation,label:"Новый",icon:t.jsx(Pt,{className:`${d.image_icon}`,size:19})},{value:y.InProgress,label:"В работе",icon:t.jsx(Yt,{className:`${d.image_icon}`,size:19})},{value:y.Completed,label:"Закрыт",icon:t.jsx(Ot,{className:`${d.image_icon}`,size:19})}],Ut=({ticket:s,onUpdate:a})=>{const[n,m]=l.useState(s.status),c=B.find(o=>o.value===n)?.label??n;return l.useEffect(()=>{m(s.status)},[s.status]),l.useEffect(()=>{n!==s.status&&a(n)},[a,n,s.status]),t.jsxs("div",{className:d.status_container,children:[t.jsxs("p",{className:d.current_status,children:["Текущий статус: ",c]}),t.jsx("div",{className:d.status_list,children:B.map(o=>t.jsxs("button",{onClick:()=>m(o.value),className:`${d.status_item} ${n===o.value?d.status_item_selected:""}`,children:[o.icon,t.jsx("span",{children:o.label})]},o.value))})]})};class Vt{async sendFeedback(a,n){await g.put(`/user/ticket/${a}/feedback`,n)}}class Gt{async getTickets(a){return{items:(await g.get("/administator/tickets",{params:{status:a?.status,sortedStatus:a?.sortBy}})).data}}async updateTicket(a){await g.post("/administator/ticket",a)}}class Ht{async updateTicket(a){return(await g.post(`/support/tickets/${a.ticketId}/reply`,{status:a.status,comment:a.comment})).data}}function Xt(s){const a=new Date(s),n=new Date,m=a.getFullYear()===n.getFullYear()&&a.getMonth()===n.getMonth()&&a.getDate()===n.getDate(),c=a.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});if(m)return`Сегодня в ${c}`;const o=a.getFullYear()===n.getFullYear(),r=a.toLocaleDateString("ru-RU",{day:"numeric",month:"long"});return o?`${r} в ${c}`:`${r} ${a.getFullYear()} г. в ${c}`}const Jt=({user:s,ticket:a,mode:n="admin",onTicketUpdated:m})=>{const[c,o]=l.useState(a),[r,j]=l.useState(!1),[C,f]=l.useState(""),$=l.useRef(null),[w,E]=l.useState(!1),b=n==="admin"||n==="support",[k,T]=l.useState(!1),z=l.useMemo(()=>new Gt,[]),M=l.useMemo(()=>new Ht,[]),W=l.useMemo(()=>new Vt,[]),[p,R]=l.useState(c.satisfactionScore??null),[N,F]=l.useState(c.satisfactionComment??""),[I,L]=l.useState(!1);if(!s)return null;l.useEffect(()=>{o(a),R(a.satisfactionScore??null),F(a.satisfactionComment??"")},[a]);const D=i=>{const _=$.current;_&&(_.style.height="auto",_.style.height=`${_.scrollHeight}px`,f(i.target.value))},S=l.useCallback(async i=>{if(!b)return;const _={...c,status:i.status??c.status,comment:i.comment??c.comment};T(!0);try{n==="support"?await M.updateTicket({ticketId:c.id,status:_.status,comment:_.comment}):await z.updateTicket({ticketId:c.id,status:_.status,comment:_.comment}),o(_),m?.(_)}catch(U){console.error("Ошибка обновления тикета:",U)}finally{T(!1)}},[z,M,b,c,n,m]),P=l.useCallback(i=>{k||S({status:i})},[S,k]),Y=async()=>{if(k)return;const i=C.trim();i&&(await S({comment:i}),f(""),j(!1))},O=async()=>{if(n==="user"&&p){L(!0);try{await W.sendFeedback(c.id,{score:p,comment:N||void 0}),o({...c,satisfactionScore:p,satisfactionComment:N})}catch(i){console.error("Не удалось отправить отзыв по тикету",i)}finally{L(!1)}}};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${e.ticket_container}`,children:[t.jsxs("div",{className:`${e.ticket_line_one}`,children:[t.jsxs("p",{className:`${e.ticket_number}`,children:["#",c.id]}),t.jsx("p",{className:`${e.ticket_status_name}`,children:c.status})]}),t.jsx("p",{className:`${e.ticket_name}`,children:c.name}),t.jsxs("div",{className:`${e.display}`,children:[t.jsx(V,{className:e.user_icon}),t.jsx("p",{className:`${e.ticket_creator_name}`,children:s.fullName}),t.jsx(G,{className:e.ticket_icon_create_data}),t.jsx("p",{className:`${e.ticket_create_data}`,children:Xt(a.createdTime)}),t.jsx(J,{className:e.ticket_type_settings}),t.jsx("p",{className:`${e.ticket_type}`,children:c.type})]}),t.jsx("p",{className:`${e.description_text}`,children:c.description}),t.jsx("button",{className:e.expand_button,onClick:()=>E(!w),children:w?"Свернуть детали":"Развернуть детали"}),w&&t.jsxs("div",{className:e.extra_content,children:[n==="admin"&&c.ai_comments.trim()&&t.jsxs("div",{className:e.ai_comment_block,children:[t.jsxs("div",{className:e.ai_comment_header,children:[t.jsx(H,{className:e.ai_icon}),t.jsx("span",{className:e.ai_title,children:"Комментарий от ИИ"})]}),t.jsx("p",{className:e.ai_comment_text,children:c.ai_comments})]}),n==="admin"&&c.comment&&t.jsxs("div",{className:e.ai_comment_block,children:[t.jsxs("div",{className:e.ai_comment_header,children:[t.jsx(v,{className:e.ai_icon}),t.jsx("span",{className:e.ai_title,children:"Комментарий администратора"})]}),t.jsx("p",{className:e.ai_comment_text,children:c.comment})]}),n==="user"&&c.comment&&t.jsxs("div",{className:e.ai_comment_block,children:[t.jsxs("div",{className:e.ai_comment_header,children:[t.jsx(v,{className:e.ai_icon}),t.jsx("span",{className:e.ai_title,children:"Ответ администратора"})]}),t.jsx("p",{className:e.ai_comment_text,children:c.comment})]}),n==="user"&&c.status==="Completed"&&t.jsxs("div",{className:e.feedback_block,children:[t.jsx("div",{className:e.ai_comment_header,children:t.jsx("span",{className:e.ai_title,children:"Оцените ответ"})}),t.jsxs("div",{className:e.feedback_controls,children:[t.jsxs("select",{className:e.feedback_select,value:p??"",onChange:i=>R(i.target.value?Number(i.target.value):null),children:[t.jsx("option",{value:"",children:"Выберите оценку"}),[1,2,3,4,5].map(i=>t.jsx("option",{value:i,children:i},i))]}),t.jsx("textarea",{className:e.feedback_textarea,placeholder:"Оставьте комментарий (необязательно)",value:N,onChange:i=>F(i.target.value)}),t.jsx("button",{className:e.button,disabled:!p||I,onClick:O,children:I?"Отправка...":"Отправить отзыв"})]})]}),b&&t.jsxs(t.Fragment,{children:[r?t.jsx("div",{className:e.input_wrapper,children:t.jsx("div",{className:e.input_with_icon,children:t.jsx("textarea",{ref:$,className:e.message_input,placeholder:"Введите сообщение...",value:C,onChange:D,rows:1})})}):t.jsxs("button",{className:e.button,onClick:()=>j(!0),children:[t.jsx(v,{className:e.button_icon}),"Написать сообщение"]}),r&&t.jsxs("div",{className:e.ticket_margin,style:{textAlign:"right"},children:[t.jsx("p",{className:e.send_message,onClick:Y,children:k?"Сохранение...":"Отправить"}),t.jsx("p",{className:e.cancel_text,onClick:()=>{f(""),j(!1)},children:"Отмена"})]}),t.jsx(Ut,{onUpdate:P,ticket:c})]})]})]})})},Zt=({list:s,mode:a="admin",onTicketUpdated:n})=>{const[m,c]=A.useState([]);return A.useEffect(()=>{const o=s.map(r=>"ticket"in r&&"user"in r?r:{ticket:r,user:r.userCreate});c(o)},[s]),t.jsx("div",{className:ot.ticket_list_container,children:m.map(({ticket:o,user:r})=>t.jsx(Jt,{ticket:o,user:r,mode:a,onTicketUpdated:n},o.id))})};export{Gt as A,Qt as C,y as T,Zt as a};
