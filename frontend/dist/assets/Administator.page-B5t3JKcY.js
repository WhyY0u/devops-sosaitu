import{j as e,F as E,r as o,U as I}from"./index-DT71n9Cl.js";import{T as n,A as P,C as q,a as A}from"./TicketList-BLOJ3emK.js";const L="_main_container_1y57j_1",U="_name_1y57j_9",F="_name_gradient_1y57j_25",M="_ticket_status_1y57j_37",D="_ticket_name_1y57j_53",W="_ticket_list_name_1y57j_69",Q="_color_grey_1y57j_97",z="_ticket_count_1y57j_111",m={main_container:L,name:U,name_gradient:F,ticket_status:M,ticket_name:D,ticket_list_name:W,color_grey:Q,ticket_count:z},B="_sorted_container_zo8yd_1",R={sorted_container:B},H="_searchWrapper_1cqgm_3",G="_searchIcon_1cqgm_23",J="_input_1cqgm_39",C={searchWrapper:H,searchIcon:G,input:J},K=({value:c,onChange:l})=>e.jsx(e.Fragment,{children:e.jsxs("label",{className:C.searchWrapper,children:[e.jsx(E,{className:C.searchIcon}),e.jsx("input",{className:C.input,placeholder:"Поиск по тикетам...",value:c,onChange:a=>l(a.target.value)})]})}),O="_sorted_click_container_4q4i8_1",V="_sort_option_4q4i8_21",X="_selected_4q4i8_55",j={sorted_click_container:O,sort_option:V,selected:X},Y=({selected:c,onChange:l})=>{const a=u=>{l(u)};return e.jsx("div",{children:e.jsxs("div",{className:j.sorted_click_container,children:[e.jsx("button",{onClick:()=>a("date"),className:`${j.sort_option} ${c==="date"?j.selected:""}`,children:"По дате"}),e.jsx("button",{onClick:()=>a("status"),className:`${j.sort_option} ${c==="status"?j.selected:""}`,children:"По статусу"})]})})},Z="_sorted_status_container_djvwj_1",ee="_text_djvwj_17",te="_text_selected_djvwj_45",se="_circle_djvwj_55",ce="_circle_selected_djvwj_83",s={sorted_status_container:Z,text:ee,text_selected:te,circle:se,circle_selected:ce},ne=({all:c,newCount:l,inProgress:a,closed:u,selected:r,onSelect:d})=>e.jsxs("div",{className:`${s.sorted_status_container}`,children:[e.jsxs("p",{onClick:()=>d("Все"),className:`${s.text}  ${r=="Все"?s.text_selected:""}`,children:["Все ",e.jsx("span",{className:`${s.circle} ${r=="Все"?s.circle_selected:""}`,children:c})]}),e.jsxs("p",{onClick:()=>d(n.Expectation),className:`${s.text} ${r==n.Expectation?s.text_selected:""}`,children:["Новые ",e.jsx("span",{className:`${s.circle} ${r==n.Expectation?s.circle_selected:""}`,children:l})]}),e.jsxs("p",{onClick:()=>d(n.InProgress),className:`${s.text} ${r==n.InProgress?s.text_selected:""}`,children:["В работе ",e.jsx("span",{className:`${s.circle} ${r==n.InProgress?s.circle_selected:""}`,children:a})]}),e.jsxs("p",{onClick:()=>d(n.Completed),className:`${s.text} ${r==n.Completed?s.text_selected:""}`,children:["Закрытые ",e.jsx("span",{className:`${s.circle} ${r==n.Completed?s.circle_selected:""}`,children:u})]})]}),re=({selectedStatus:c,onStatusChange:l,sortBy:a,onSortChange:u,searchQuery:r,onSearchChange:d,counts:i})=>e.jsxs("div",{className:R.sorted_container,children:[e.jsx(K,{value:r,onChange:d}),e.jsx(Y,{selected:a,onChange:u}),e.jsx(ne,{selected:c,onSelect:l,all:i.all,closed:i.closed,inProgress:i.inProgress,newCount:i.new})]}),ie=()=>{const[c,l]=o.useState("Все"),[a,u]=o.useState("date"),[r,d]=o.useState(""),[i,y]=o.useState([]),[k,v]=o.useState(null),N=o.useMemo(()=>new P,[]),$=o.useMemo(()=>new I,[]);o.useEffect(()=>{$.getMe().then(t=>v(t))},[$]),o.useEffect(()=>{k&&N.getTickets({status:"Все"}).then(t=>{y(t.items)})},[k,N]);const S=o.useMemo(()=>i.reduce((t,p)=>{switch(p.ticket.status){case n.Expectation:t.new+=1;break;case n.InProgress:t.inProgress+=1;break;case n.Completed:t.closed+=1;break}return t.all+=1,t},{all:0,new:0,inProgress:0,closed:0}),[i]),w=o.useMemo(()=>{const t=i.filter(_=>c==="Все"?!0:_.ticket.status===c),p=r.trim().toLowerCase(),x=p?t.filter(_=>{const h=_.ticket.name.toLowerCase(),g=_.ticket.description.toLowerCase();return h.includes(p)||g.includes(p)}):t;if(a==="status"){const _={[n.Expectation]:0,[n.InProgress]:1,[n.Completed]:2};return[...x].sort((h,g)=>{const T=_[h.ticket.status]-_[g.ticket.status];return T!==0?T:new Date(g.ticket.createdTime).getTime()-new Date(h.ticket.createdTime).getTime()})}return[...x].sort((_,h)=>new Date(h.ticket.createdTime).getTime()-new Date(_.ticket.createdTime).getTime())},[r,c,a,i]),f=t=>{l(t)},b=o.useCallback(t=>{y(p=>p.map(x=>x.ticket.id===t.id?{...x,ticket:t}:x))},[]);return e.jsxs("div",{className:m.main_container,children:[e.jsxs("p",{className:m.name,children:["Добро пожаловать,",e.jsx("br",{}),e.jsx("span",{className:m.name_gradient,children:k?.fullName||"..."})]}),e.jsx("p",{className:m.ticket_status,children:"Сильный не тот, кто судит, а тот, кто помогает"}),e.jsx(q,{counts:S}),e.jsx(re,{counts:S,sortBy:a,onSortChange:u,onStatusChange:f,selectedStatus:c,searchQuery:r,onSearchChange:d}),e.jsxs("div",{className:m.ticket_list_name,children:[e.jsxs("p",{className:m.ticket_name,children:["Тикеты",c!=="Все"&&e.jsxs("span",{className:m.color_grey,children:["• ",c]})]}),e.jsxs("p",{className:m.ticket_count,children:[w.length," из ",i.length]})]}),k&&e.jsx(A,{list:w,mode:"admin",onTicketUpdated:b})]})};export{ie as default};
