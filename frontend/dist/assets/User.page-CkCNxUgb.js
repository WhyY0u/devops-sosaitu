import{r as a,j as e,i as y,U as f}from"./index-Cz5C6War.js";import{C as S,a as C,T as b}from"./TicketList-Dy9_Iu8c.js";const T="_main_container_jaxdf_1",v="_name_jaxdf_9",E="_name_gradient_jaxdf_25",L="_ticket_status_jaxdf_37",g={main_container:T,name:v,name_gradient:E,ticket_status:L},I="_container_create_ticket_k5pax_1",R="_plus_k5pax_19",$="_title_container_k5pax_49",D="_create_ticket_label_k5pax_61",P="_label_k5pax_73",U="_label_text_k5pax_85",B="_input_k5pax_99",H="_textarea_k5pax_129",M="_button_k5pax_163",O="_counter_k5pax_225",t={container_create_ticket:I,plus:R,title_container:$,create_ticket_label:D,label:P,label_text:U,input:B,textarea:H,button:M,counter:O},A="_dropdown_23yde_1",F="_dropdownHeader_23yde_13",V="_arrow_23yde_47",q="_open_23yde_55",z="_dropdownList_23yde_63",G="_show_23yde_93",J="_dropdownItem_23yde_105",u={dropdown:A,dropdownHeader:F,arrow:V,open:q,dropdownList:z,show:G,dropdownItem:J},K=({options:_,placeholder:n="Выберите...",onSelect:s})=>{const[o,r]=a.useState(!1),[m,x]=a.useState(""),l=a.useRef(null),h=()=>r(!o),w=c=>{x(c),s(c),r(!1)};return a.useEffect(()=>{const c=i=>{l.current&&!l.current.contains(i.target)&&r(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]),e.jsxs("div",{className:u.dropdown,ref:l,children:[e.jsxs("div",{className:u.dropdownHeader,onClick:h,children:[e.jsx("span",{children:m||n}),e.jsx("span",{className:`${u.arrow} ${o?u.open:""}`,children:"▼"})]}),e.jsx("ul",{className:`${u.dropdownList} ${o?u.show:""}`,children:_.map((c,i)=>e.jsx("li",{className:u.dropdownItem,onClick:()=>w(c),children:c},i))})]})};class N{async getTickets(n,s){return(await y.get("/user/tickets",{params:{status:s?.status,sortBy:s?.sortBy}})).data}async createTicket(n,s){if(!n)throw new Error("User is required");await y.post("/user/createTicket",{name:s.title,description:s.description,type:s.category})}async getTicketById(n){throw new Error("Method not implemented.")}async updateTicket(n){throw new Error("Method not implemented.")}}const Q=({user:_})=>{const[n,s]=a.useState(""),[o,r]=a.useState(""),[m,x]=a.useState(""),[l,h]=a.useState(!1),[w,c]=a.useState(null),[i,k]=a.useState(!1),j=n.trim().length>0&&o.trim().length>0&&m,p=async()=>{if(j){h(!0),c(null),k(!1);try{await new N().createTicket(_,{title:n,description:o,category:m}),k(!0),s(""),r(""),x("")}catch(d){c(d.message||"Произошла ошибка при создании тикета")}finally{h(!1)}}};return e.jsxs("div",{className:t.container_create_ticket,children:[e.jsxs("div",{className:t.title_container,children:[e.jsx("p",{className:t.plus,children:"+"}),e.jsx("p",{className:t.create_ticket_label,children:"Создать новый тикет"})]}),e.jsxs("label",{className:t.label,children:[e.jsx("p",{className:t.label_text,children:"Тема обращения"}),e.jsx("input",{className:t.input,placeholder:"Опишите кратко суть вопроса...",maxLength:30,value:n,onChange:d=>s(d.target.value)}),e.jsxs("span",{className:t.counter,children:[n.length,"/30"]})]}),e.jsxs("label",{className:t.label,children:[e.jsx("p",{className:t.label_text,children:"Подробное описание"}),e.jsx("textarea",{className:t.textarea,placeholder:"Расскажите подробнее о вашем вопросе или проблеме...",maxLength:1e3,value:o,onChange:d=>r(d.target.value)}),e.jsxs("span",{className:t.counter,children:[o.length,"/1000"]})]}),e.jsxs("label",{className:t.label,children:[e.jsx("p",{className:t.label_text,children:"Категория обращения"}),e.jsx(K,{options:_.groups,placeholder:"Выберите категорию...",onSelect:x})]}),w&&e.jsx("p",{className:t.error,children:w}),i&&e.jsx("p",{className:t.success,children:"Тикет успешно создан!"}),e.jsx("button",{className:t.button,disabled:!j||l,onClick:p,children:l?"Отправка...":"Отправить тикет"})]})},Y=()=>{const[_,n]=a.useState({all:0,new:0,inProgress:0,closed:0}),[s,o]=a.useState(null),[r,m]=a.useState([]),x=new N,l=new f;a.useEffect(()=>{(async()=>{const i=await l.getMe();o(i);const k=await x.getTickets(i,{sortBy:"date",status:"Все"});m(k.items);const j=k.items.reduce((p,d)=>{switch(d.status){case b.Expectation:p.new+=1;break;case b.InProgress:p.inProgress+=1;break;case b.Completed:p.closed+=1;break}return p.all+=1,p},{all:0,new:0,inProgress:0,closed:0});n(j)})()},[]);const h=localStorage.getItem("name")?.trim(),w=s?.fullName?.trim()||h||"...";return e.jsxs("div",{className:g.main_container,children:[e.jsxs("p",{className:g.name,children:["Добро пожаловать,",e.jsx("br",{}),e.jsxs("span",{className:g.name_gradient,children:[w,"!"]})]}),e.jsx("p",{className:g.ticket_status,children:"Создавайте тикеты и отслеживайте их статус"}),e.jsx(S,{counts:_}),s&&e.jsx(Q,{user:s}),s&&e.jsx(C,{list:r,mode:"user"})]})};export{Y as default};
