import{G as h,j as t,r as o,a as b,o as tt,p as et,q as st,s as $,t as Y}from"./index-3cPMuINo.js";function at(a){return h({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeMiterlimit:"10",strokeWidth:"32",d:"M416.07 272a160 160 0 1 0-160 160 160 160 0 0 0 160-160zM142.12 91.21A46.67 46.67 0 0 0 112 80l-2.79.08C83.66 81.62 64 104 64.07 131c0 13.21 4.66 19.37 10.88 27.23a4.55 4.55 0 0 0 3.24 1.77h.88a3.23 3.23 0 0 0 2.54-1.31L142.38 99a5.38 5.38 0 0 0 1.55-4 5.26 5.26 0 0 0-1.81-3.79zm227.76 0A46.67 46.67 0 0 1 400 80l2.79.08C428.34 81.62 448 104 447.93 131c0 13.21-4.66 19.37-10.88 27.23a4.55 4.55 0 0 1-3.24 1.76h-.88a3.23 3.23 0 0 1-2.54-1.31L369.62 99a5.38 5.38 0 0 1-1.55-4 5.26 5.26 0 0 1 1.81-3.79z"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256.07 160v112h-80m240 160-40-40m-280 40 40-40"},child:[]}]})(a)}function ct(a){return h({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M262.29 192.31a64 64 0 1 0 57.4 57.4 64.13 64.13 0 0 0-57.4-57.4zM416.39 256a154.34 154.34 0 0 1-1.53 20.79l45.21 35.46a10.81 10.81 0 0 1 2.45 13.75l-42.77 74a10.81 10.81 0 0 1-13.14 4.59l-44.9-18.08a16.11 16.11 0 0 0-15.17 1.75A164.48 164.48 0 0 1 325 400.8a15.94 15.94 0 0 0-8.82 12.14l-6.73 47.89a11.08 11.08 0 0 1-10.68 9.17h-85.54a11.11 11.11 0 0 1-10.69-8.87l-6.72-47.82a16.07 16.07 0 0 0-9-12.22 155.3 155.3 0 0 1-21.46-12.57 16 16 0 0 0-15.11-1.71l-44.89 18.07a10.81 10.81 0 0 1-13.14-4.58l-42.77-74a10.8 10.8 0 0 1 2.45-13.75l38.21-30a16.05 16.05 0 0 0 6-14.08c-.36-4.17-.58-8.33-.58-12.5s.21-8.27.58-12.35a16 16 0 0 0-6.07-13.94l-38.19-30A10.81 10.81 0 0 1 49.48 186l42.77-74a10.81 10.81 0 0 1 13.14-4.59l44.9 18.08a16.11 16.11 0 0 0 15.17-1.75A164.48 164.48 0 0 1 187 111.2a15.94 15.94 0 0 0 8.82-12.14l6.73-47.89A11.08 11.08 0 0 1 213.23 42h85.54a11.11 11.11 0 0 1 10.69 8.87l6.72 47.82a16.07 16.07 0 0 0 9 12.22 155.3 155.3 0 0 1 21.46 12.57 16 16 0 0 0 15.11 1.71l44.89-18.07a10.81 10.81 0 0 1 13.14 4.58l42.77 74a10.8 10.8 0 0 1-2.45 13.75l-38.21 30a16.05 16.05 0 0 0-6.05 14.08c.33 4.14.55 8.3.55 12.47z"},child:[]}]})(a)}function nt(a){return h({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeMiterlimit:"10",strokeWidth:"32",d:"M366.05 146a46.7 46.7 0 0 1-2.42-63.42 3.87 3.87 0 0 0-.22-5.26l-44.13-44.18a3.89 3.89 0 0 0-5.5 0l-70.34 70.34a23.62 23.62 0 0 0-5.71 9.24 23.66 23.66 0 0 1-14.95 15 23.7 23.7 0 0 0-9.25 5.71L33.14 313.78a3.89 3.89 0 0 0 0 5.5l44.13 44.13a3.87 3.87 0 0 0 5.26.22 46.69 46.69 0 0 1 65.84 65.84 3.87 3.87 0 0 0 .22 5.26l44.13 44.13a3.89 3.89 0 0 0 5.5 0l180.4-180.39a23.7 23.7 0 0 0 5.71-9.25 23.66 23.66 0 0 1 14.95-15 23.62 23.62 0 0 0 9.24-5.71l70.34-70.34a3.89 3.89 0 0 0 0-5.5l-44.13-44.13a3.87 3.87 0 0 0-5.26-.22 46.7 46.7 0 0 1-63.42-2.32z"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"m250.5 140.44-16.51-16.51m60.53 60.53-11.01-11m55.03 55.03-11-11.01m60.53 60.53-16.51-16.51"},child:[]}]})(a)}const it="_ticketStat_jf3yd_1",ot="_topRow_jf3yd_12",rt="_iconWrapper_jf3yd_20",lt="_count_jf3yd_28",_t="_label_jf3yd_36",k={ticketStat:it,topRow:ot,iconWrapper:rt,count:lt,label:_t},j=({icon:a,label:c,count:n})=>t.jsxs("div",{className:k.ticketStat,children:[t.jsxs("div",{className:k.topRow,children:[t.jsx("div",{className:k.iconWrapper,children:a}),t.jsx("p",{className:k.count,children:n})]}),t.jsx("p",{className:k.label,children:c})]});function mt(a){return h({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M362.6 192.9L345 174.8c-.7-.8-1.8-1.2-2.8-1.2-1.1 0-2.1.4-2.8 1.2l-122 122.9-44.4-44.4c-.8-.8-1.8-1.2-2.8-1.2-1 0-2 .4-2.8 1.2l-17.8 17.8c-1.6 1.6-1.6 4.1 0 5.7l56 56c3.6 3.6 8 5.7 11.7 5.7 5.3 0 9.9-3.9 11.6-5.5h.1l133.7-134.4c1.4-1.7 1.4-4.2-.1-5.7z"},child:[]},{tag:"path",attr:{d:"M256 76c48.1 0 93.3 18.7 127.3 52.7S436 207.9 436 256s-18.7 93.3-52.7 127.3S304.1 436 256 436c-48.1 0-93.3-18.7-127.3-52.7S76 304.1 76 256s18.7-93.3 52.7-127.3S207.9 76 256 76m0-28C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z"},child:[]}]})(a)}function dt(a){return h({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M235.4 172.2c0-11.4 9.3-19.9 20.5-19.9 11.4 0 20.7 8.5 20.7 19.9s-9.3 20-20.7 20c-11.2 0-20.5-8.6-20.5-20zm1.4 35.7H275V352h-38.2V207.9z"},child:[]},{tag:"path",attr:{d:"M256 76c48.1 0 93.3 18.7 127.3 52.7S436 207.9 436 256s-18.7 93.3-52.7 127.3S304.1 436 256 436c-48.1 0-93.3-18.7-127.3-52.7S76 304.1 76 256s18.7-93.3 52.7-127.3S207.9 76 256 76m0-28C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z"},child:[]}]})(a)}const ut="_container_ticket_wtj3m_1",pt={container_ticket:ut},_e=({counts:a})=>t.jsxs("div",{className:`${pt.container_ticket}`,children:[t.jsx(j,{icon:t.jsx(nt,{style:{color:"#6065fa",fontSize:"28px"}}),label:"Всего тикетов",count:a.all}),t.jsx(j,{icon:t.jsx(dt,{style:{color:"#3b82f6",fontSize:"28px"}}),label:"Новые",count:a.new}),t.jsx(j,{icon:t.jsx(at,{style:{color:"#f97316",fontSize:"28px"}}),label:"В работе",count:a.inProgress}),t.jsx(j,{icon:t.jsx(mt,{style:{color:"#22c55e",fontSize:"28px"}}),label:"Закрыте",count:a.inProgress})]}),q={Expectation:"Expectation",InProgress:"InProgress",Completed:"Completed"},ht="_ticket_list_container_5mrao_1",xt={ticket_list_container:ht},kt="_ticket_container_1qr1m_1",ft="_ticket_line_one_1qr1m_12",gt="_ticket_number_1qr1m_17",jt="_ticket_status_name_1qr1m_31",bt="_user_icon_1qr1m_44",vt="_ticket_name_1qr1m_51",Nt="_display_1qr1m_58",yt="_ticket_creator_name_1qr1m_62",St="_ticket_icon_create_data_1qr1m_68",wt="_ticket_create_data_1qr1m_76",Ct="_ticket_type_1qr1m_82",$t="_ticket_type_settings_1qr1m_88",qt="_description_text_1qr1m_96",Tt="_button_1qr1m_105",zt="_button_icon_1qr1m_119",Mt="_input_wrapper_1qr1m_123",Rt="_input_with_icon_1qr1m_131",Bt="_message_input_1qr1m_136",Ft="_ticket_margin_1qr1m_181",It="_cancel_text_1qr1m_187",Lt="_send_message_1qr1m_188",At="_ai_comment_block_1qr1m_226",Wt="_ai_comment_header_1qr1m_235",Et="_ai_icon_1qr1m_244",Dt="_ai_title_1qr1m_249",Pt="_ai_comment_text_1qr1m_255",Yt="_expand_button_1qr1m_274",Ot="_feedback_block_1qr1m_313",Ht="_feedback_controls_1qr1m_322",Ut="_feedback_select_1qr1m_328",Vt="_feedback_textarea_1qr1m_344",e={ticket_container:kt,ticket_line_one:ft,ticket_number:gt,ticket_status_name:jt,user_icon:bt,ticket_name:vt,display:Nt,ticket_creator_name:yt,ticket_icon_create_data:St,ticket_create_data:wt,ticket_type:Ct,ticket_type_settings:$t,description_text:qt,button:Tt,button_icon:zt,input_wrapper:Mt,input_with_icon:Rt,message_input:Bt,ticket_margin:Ft,cancel_text:It,send_message:Lt,ai_comment_block:At,ai_comment_header:Wt,ai_icon:Et,ai_title:Dt,ai_comment_text:Pt,expand_button:Yt,feedback_block:Ot,feedback_controls:Ht,feedback_select:Ut,feedback_textarea:Vt},Gt="_status_container_1po23_1",Xt="_current_status_1po23_6",Jt="_status_list_1po23_13",Kt="_status_item_1po23_19",Qt="_image_icon_1po23_35",Zt="_status_item_selected_1po23_38",p={status_container:Gt,current_status:Xt,status_list:Jt,status_item:Kt,image_icon:Qt,status_item_selected:Zt};function te(a){return h({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"},child:[]},{tag:"path",attr:{d:"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"},child:[]}]})(a)}function ee(a){return h({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"},child:[]},{tag:"path",attr:{d:"M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"},child:[]}]})(a)}function se(a){return h({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M9.172 16.242 12 13.414l2.828 2.828 1.414-1.414L13.414 12l2.828-2.828-1.414-1.414L12 10.586 9.172 7.758 7.758 9.172 10.586 12l-2.828 2.828z"},child:[]},{tag:"path",attr:{d:"M12 22c5.514 0 10-4.486 10-10S17.514 2 12 2 2 6.486 2 12s4.486 10 10 10zm0-18c4.411 0 8 3.589 8 8s-3.589 8-8 8-8-3.589-8-8 3.589-8 8-8z"},child:[]}]})(a)}const O=[{value:q.Expectation,label:"Новый",icon:t.jsx(te,{className:`${p.image_icon}`,size:19})},{value:q.InProgress,label:"В работе",icon:t.jsx(ee,{className:`${p.image_icon}`,size:19})},{value:q.Completed,label:"Закрыт",icon:t.jsx(se,{className:`${p.image_icon}`,size:19})}],ae=({ticket:a,onUpdate:c})=>{const[n,m]=o.useState(a.status),s=O.find(r=>r.value===n)?.label??n;return o.useEffect(()=>{m(a.status)},[a.status]),o.useEffect(()=>{n!==a.status&&c(n)},[c,n,a.status]),t.jsxs("div",{className:p.status_container,children:[t.jsxs("p",{className:p.current_status,children:["Текущий статус: ",s]}),t.jsx("div",{className:p.status_list,children:O.map(r=>t.jsxs("button",{onClick:()=>m(r.value),className:`${p.status_item} ${n===r.value?p.status_item_selected:""}`,children:[r.icon,t.jsx("span",{children:r.label})]},r.value))})]})};class ce{async sendFeedback(c,n){await b.put(`/user/ticket/${c}/feedback`,n)}}class ne{async getTickets(c){return{items:(await b.get("/administator/tickets",{params:{status:c?.status,sortedStatus:c?.sortBy}})).data}}async updateTicket(c){await b.post("/administator/ticket",c)}}class ie{async updateTicket(c){await b.post(`/support/ticket/${c.ticketId}/response`,{response:c.comment,status:c.status})}}function oe(a){const c=new Date(a),n=new Date,m=c.getFullYear()===n.getFullYear()&&c.getMonth()===n.getMonth()&&c.getDate()===n.getDate(),s=c.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});if(m)return`Сегодня в ${s}`;const r=c.getFullYear()===n.getFullYear(),_=c.toLocaleDateString("ru-RU",{day:"numeric",month:"long"});return r?`${_} в ${s}`:`${_} ${c.getFullYear()} г. в ${s}`}const re=({user:a,ticket:c,mode:n="admin",onTicketUpdated:m})=>{const[s,r]=o.useState(c),[_,v]=o.useState(!1),[T,N]=o.useState(""),z=o.useRef(null),[f,H]=o.useState(!1),y=n==="admin"||n==="support",[g,M]=o.useState(!1),R=o.useMemo(()=>new ne,[]),B=o.useMemo(()=>new ie,[]),U=o.useMemo(()=>new ce,[]),[d,F]=o.useState(s.satisfactionScore??null),[S,I]=o.useState(s.satisfactionComment??""),[L,A]=o.useState(!1);if(!a)return null;o.useEffect(()=>{r(c),F(c.satisfactionScore??null),I(c.satisfactionComment??"")},[c]);const W=o.useMemo(()=>{const i=s.administratorResponse||s.comment;return n==="admin"?!!(s.ai_comments?.trim()||i):n==="user"?!!(i||s.status==="Completed"&&!d):!1},[s,n,d]),E=i=>{const l=i.match(/^\*\*(.+?)\*\*\s*\(([^)]+)\):\s*(.*)$/s);if(l){const[,u,C,x]=l;return t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"8px",paddingBottom:"8px",borderBottom:"1px solid #d0e3f0"},children:[t.jsx("span",{style:{fontWeight:600,color:"#2c3e50"},children:u}),t.jsx("span",{style:{color:"#7f8c8d",fontSize:"13px",marginLeft:"10px"},children:C})]}),t.jsx("div",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:x.trim()})]})}if(i.includes("---")){const u=i.split("---");return t.jsx("div",{children:u.map((C,x)=>{const D=C.trim(),P=D.match(/^\*\*(.+?)\*\*\s*\(([^)]+)\):\s*(.*)$/s);if(P){const[,K,Q,Z]=P;return t.jsxs("div",{style:{marginBottom:x<u.length-1?"16px":"0",paddingBottom:x<u.length-1?"16px":"0",borderBottom:x<u.length-1?"1px solid #d0e3f0":"none"},children:[t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("span",{style:{fontWeight:600,color:"#2c3e50"},children:K}),t.jsx("span",{style:{color:"#7f8c8d",fontSize:"13px",marginLeft:"10px"},children:Q})]}),t.jsx("div",{style:{whiteSpace:"pre-wrap",lineHeight:1.6},children:Z.trim()})]},x)}return t.jsx("div",{style:{whiteSpace:"pre-wrap"},children:D},x)})})}return t.jsx("span",{style:{whiteSpace:"pre-wrap"},children:i})},V=i=>{const l=z.current;l&&(l.style.height="auto",l.style.height=`${l.scrollHeight}px`,N(i.target.value))},w=o.useCallback(async i=>{if(!y)return;const l={...s,status:i.status??s.status,comment:i.comment??s.comment};M(!0);try{n==="support"?await B.updateTicket({ticketId:s.id,status:l.status,comment:l.comment}):await R.updateTicket({ticketId:s.id,status:l.status,comment:l.comment}),r(l),m?.(l)}catch(u){console.error("Ошибка обновления тикета:",u)}finally{M(!1)}},[R,B,y,s,n,m]),G=o.useCallback(i=>{g||w({status:i})},[w,g]),X=async()=>{if(g)return;const i=T.trim();i&&(await w({comment:i}),N(""),v(!1))},J=async()=>{if(n==="user"&&d){A(!0);try{await U.sendFeedback(s.id,{score:d,comment:S||void 0}),r({...s,satisfactionScore:d,satisfactionComment:S})}catch(i){console.error("Не удалось отправить отзыв по тикету",i)}finally{A(!1)}}};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${e.ticket_container}`,children:[t.jsxs("div",{className:`${e.ticket_line_one}`,children:[t.jsxs("p",{className:`${e.ticket_number}`,children:["#",s.id]}),t.jsx("p",{className:`${e.ticket_status_name}`,children:s.status})]}),t.jsx("p",{className:`${e.ticket_name}`,children:s.name}),t.jsxs("div",{className:`${e.display}`,children:[t.jsx(tt,{className:e.user_icon}),t.jsx("p",{className:`${e.ticket_creator_name}`,children:a.fullName}),t.jsx(et,{className:e.ticket_icon_create_data}),t.jsx("p",{className:`${e.ticket_create_data}`,children:oe(c.createdTime)}),t.jsx(ct,{className:e.ticket_type_settings}),t.jsx("p",{className:`${e.ticket_type}`,children:s.type})]}),t.jsx("p",{className:`${e.description_text}`,children:s.description}),W&&t.jsx("button",{className:e.expand_button,onClick:()=>H(!f),"aria-expanded":f,children:f?"Свернуть детали":"Развернуть детали"}),f&&W&&t.jsxs("div",{className:e.extra_content,children:[n==="admin"&&s.ai_comments?.trim()&&t.jsxs("div",{className:e.ai_comment_block,children:[t.jsxs("div",{className:e.ai_comment_header,children:[t.jsx(st,{className:e.ai_icon}),t.jsx("span",{className:e.ai_title,children:"Комментарий от ИИ"})]}),t.jsx("p",{className:e.ai_comment_text,children:s.ai_comments})]}),n==="admin"&&(s.administratorResponse||s.comment)&&t.jsxs("div",{className:e.ai_comment_block,children:[t.jsxs("div",{className:e.ai_comment_header,children:[t.jsx($,{className:e.ai_icon}),t.jsx("span",{className:e.ai_title,children:"Комментарий администратора"})]}),t.jsx("div",{className:e.ai_comment_text,children:E(s.administratorResponse||s.comment)})]}),n==="user"&&(s.administratorResponse||s.comment)&&t.jsxs("div",{className:e.ai_comment_block,children:[t.jsxs("div",{className:e.ai_comment_header,children:[t.jsx($,{className:e.ai_icon}),t.jsx("span",{className:e.ai_title,children:"Ответ администратора"})]}),t.jsx("div",{className:e.ai_comment_text,children:E(s.administratorResponse||s.comment)})]}),n==="user"&&s.status==="Completed"&&d===null&&t.jsxs("div",{className:e.feedback_block,children:[t.jsx("div",{className:e.ai_comment_header,children:t.jsx("span",{className:e.ai_title,children:"Оцените ответ"})}),t.jsxs("div",{className:e.feedback_controls,children:[t.jsxs("select",{className:e.feedback_select,value:d??"",onChange:i=>F(i.target.value?Number(i.target.value):null),children:[t.jsx("option",{value:"",children:"Выберите оценку"}),[1,2,3,4,5].map(i=>t.jsx("option",{value:i,children:i},i))]}),t.jsx("textarea",{className:e.feedback_textarea,placeholder:"Оставьте комментарий (необязательно)",value:S,onChange:i=>I(i.target.value)}),t.jsx("button",{className:e.button,disabled:!d||L,onClick:J,children:L?"Отправка...":"Отправить отзыв"})]})]}),y&&t.jsxs(t.Fragment,{children:[_?t.jsx("div",{className:e.input_wrapper,children:t.jsx("div",{className:e.input_with_icon,children:t.jsx("textarea",{ref:z,className:e.message_input,placeholder:"Введите сообщение...",value:T,onChange:V,rows:1})})}):t.jsxs("button",{className:e.button,onClick:()=>v(!0),children:[t.jsx($,{className:e.button_icon}),"Написать сообщение"]}),_&&t.jsxs("div",{className:e.ticket_margin,style:{textAlign:"right"},children:[t.jsx("p",{className:e.send_message,onClick:X,children:g?"Сохранение...":"Отправить"}),t.jsx("p",{className:e.cancel_text,onClick:()=>{N(""),v(!1)},children:"Отмена"})]}),t.jsx(ae,{onUpdate:G,ticket:s})]})]})]})})},me=({list:a,mode:c="admin",onTicketUpdated:n})=>{const[m,s]=Y.useState([]);return Y.useEffect(()=>{const r=a.map(_=>"ticket"in _&&"user"in _?_:{ticket:_,user:_.userCreate});s(r)},[a]),t.jsx("div",{className:xt.ticket_list_container,children:m.map(({ticket:r,user:_})=>t.jsx(re,{ticket:r,user:_,mode:c,onTicketUpdated:n},r.id))})};export{ne as A,_e as C,q as T,me as a};
