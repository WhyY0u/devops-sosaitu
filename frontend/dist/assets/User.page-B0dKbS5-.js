import{r as n,j as e,i as b,U as N}from"./index-DT71n9Cl.js";import{C as S,a as C,T as g}from"./TicketList-BLOJ3emK.js";const T="_main_container_jaxdf_1",v="_name_jaxdf_9",E="_name_gradient_jaxdf_25",L="_ticket_status_jaxdf_37",j={main_container:T,name:v,name_gradient:E,ticket_status:L},I="_container_create_ticket_k5pax_1",R="_plus_k5pax_19",$="_title_container_k5pax_49",D="_create_ticket_label_k5pax_61",P="_label_k5pax_73",U="_label_text_k5pax_85",B="_input_k5pax_99",H="_textarea_k5pax_129",M="_button_k5pax_163",O="_counter_k5pax_225",t={container_create_ticket:I,plus:R,title_container:$,create_ticket_label:D,label:P,label_text:U,input:B,textarea:H,button:M,counter:O},A="_dropdown_23yde_1",F="_dropdownHeader_23yde_13",V="_arrow_23yde_47",q="_open_23yde_55",z="_dropdownList_23yde_63",G="_show_23yde_93",J="_dropdownItem_23yde_105",u={dropdown:A,dropdownHeader:F,arrow:V,open:q,dropdownList:z,show:G,dropdownItem:J},K=({options:d,placeholder:c="Выберите...",onSelect:s})=>{const[r,o]=n.useState(!1),[m,x]=n.useState(""),l=n.useRef(null),w=()=>o(!r),_=a=>{x(a),s(a),o(!1)};return n.useEffect(()=>{const a=p=>{l.current&&!l.current.contains(p.target)&&o(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),e.jsxs("div",{className:u.dropdown,ref:l,children:[e.jsxs("div",{className:u.dropdownHeader,onClick:w,children:[e.jsx("span",{children:m||c}),e.jsx("span",{className:`${u.arrow} ${r?u.open:""}`,children:"▼"})]}),e.jsx("ul",{className:`${u.dropdownList} ${r?u.show:""}`,children:d.map((a,p)=>e.jsx("li",{className:u.dropdownItem,onClick:()=>_(a),children:a},p))})]})};class y{async getTickets(c,s){return(await b.get("/user/tickets",{params:{status:s?.status,sortBy:s?.sortBy}})).data}async createTicket(c,s){if(!c)throw new Error("User is required");await b.post("/user/createTicket",{name:s.title,description:s.description,type:s.category})}async getTicketById(c){throw new Error("Method not implemented.")}async updateTicket(c){throw new Error("Method not implemented.")}}const Q=({user:d})=>{const[c,s]=n.useState(""),[r,o]=n.useState(""),[m,x]=n.useState(""),[l,w]=n.useState(!1),[_,a]=n.useState(null),[p,i]=n.useState(!1),k=c.trim().length>0&&r.trim().length>0&&m,f=async()=>{if(k){w(!0),a(null),i(!1);try{await new y().createTicket(d,{title:c,description:r,category:m}),i(!0),s(""),o(""),x("")}catch(h){a(h.message||"Произошла ошибка при создании тикета")}finally{w(!1)}}};return e.jsxs("div",{className:t.container_create_ticket,children:[e.jsxs("div",{className:t.title_container,children:[e.jsx("p",{className:t.plus,children:"+"}),e.jsx("p",{className:t.create_ticket_label,children:"Создать новый тикет"})]}),e.jsxs("label",{className:t.label,children:[e.jsx("p",{className:t.label_text,children:"Тема обращения"}),e.jsx("input",{className:t.input,placeholder:"Опишите кратко суть вопроса...",maxLength:30,value:c,onChange:h=>s(h.target.value)}),e.jsxs("span",{className:t.counter,children:[c.length,"/30"]})]}),e.jsxs("label",{className:t.label,children:[e.jsx("p",{className:t.label_text,children:"Подробное описание"}),e.jsx("textarea",{className:t.textarea,placeholder:"Расскажите подробнее о вашем вопросе или проблеме...",maxLength:1e3,value:r,onChange:h=>o(h.target.value)}),e.jsxs("span",{className:t.counter,children:[r.length,"/1000"]})]}),e.jsxs("label",{className:t.label,children:[e.jsx("p",{className:t.label_text,children:"Категория обращения"}),e.jsx(K,{options:d.groups,placeholder:"Выберите категорию...",onSelect:x})]}),_&&e.jsx("p",{className:t.error,children:_}),p&&e.jsx("p",{className:t.success,children:"Тикет успешно создан!"}),e.jsx("button",{className:t.button,disabled:!k||l,onClick:f,children:l?"Отправка...":"Отправить тикет"})]})},Y=()=>{const[d,c]=n.useState({all:0,new:0,inProgress:0,closed:0}),[s,r]=n.useState(null),[o,m]=n.useState([]),x=new y,l=new N;return n.useEffect(()=>{(async()=>{const _=await l.getMe();r(_);const a=await x.getTickets(_,{sortBy:"date",status:"Все"});m(a.items);const p=a.items.reduce((i,k)=>{switch(k.status){case g.Expectation:i.new+=1;break;case g.InProgress:i.inProgress+=1;break;case g.Completed:i.closed+=1;break}return i.all+=1,i},{all:0,new:0,inProgress:0,closed:0});c(p)})()},[]),e.jsxs("div",{className:j.main_container,children:[e.jsxs("p",{className:j.name,children:["Добро пожаловать,",e.jsx("br",{}),e.jsxs("span",{className:j.name_gradient,children:[s?.fullName,"!"]})]}),e.jsx("p",{className:j.ticket_status,children:"Создавайте тикеты и отслеживайте их статус"}),e.jsx(S,{counts:d}),s&&e.jsx(Q,{user:s}),s&&e.jsx(C,{list:o,mode:"user"})]})};export{Y as default};
