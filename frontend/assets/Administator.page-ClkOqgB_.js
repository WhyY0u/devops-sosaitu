import{j as e,F as z,r as o,U as E}from"./index-CKLftP6T.js";import{T as n,A as I,C as P,a as A}from"./TicketList-Uvjy3bVV.js";const L="_main_container_1swez_1",U="_name_1swez_5",F="_name_gradient_1swez_13",M="_ticket_status_1swez_19",q="_ticket_name_1swez_27",D="_ticket_list_name_1swez_35",W="_color_grey_1swez_49",Q="_ticket_count_1swez_56",m={main_container:L,name:U,name_gradient:F,ticket_status:M,ticket_name:q,ticket_list_name:D,color_grey:W,ticket_count:Q},B="_sorted_container_sfftf_1",R={sorted_container:B},H="_searchWrapper_kxxto_2",G="_searchIcon_kxxto_12",J="_input_kxxto_20",C={searchWrapper:H,searchIcon:G,input:J},K=({value:c,onChange:l})=>e.jsx(e.Fragment,{children:e.jsxs("label",{className:C.searchWrapper,children:[e.jsx(z,{className:C.searchIcon}),e.jsx("input",{className:C.input,placeholder:"Поиск по тикетам...",value:c,onChange:r=>l(r.target.value)})]})}),O="_sorted_click_container_s3k3q_1",V="_sort_option_s3k3q_11",X="_selected_s3k3q_28",k={sorted_click_container:O,sort_option:V,selected:X},Y=({selected:c,onChange:l})=>{const r=u=>{l(u)};return e.jsx("div",{children:e.jsxs("div",{className:k.sorted_click_container,children:[e.jsx("button",{onClick:()=>r("date"),className:`${k.sort_option} ${c==="date"?k.selected:""}`,children:"По дате"}),e.jsx("button",{onClick:()=>r("status"),className:`${k.sort_option} ${c==="status"?k.selected:""}`,children:"По статусу"})]})})},Z="_sorted_status_container_1xhya_1",ee="_text_1xhya_9",te="_text_selected_1xhya_23",se="_circle_1xhya_28",ce="_circle_selected_1xhya_42",s={sorted_status_container:Z,text:ee,text_selected:te,circle:se,circle_selected:ce},ne=({all:c,newCount:l,inProgress:r,closed:u,selected:a,onSelect:d})=>e.jsxs("div",{className:`${s.sorted_status_container}`,children:[e.jsxs("p",{onClick:()=>d("Все"),className:`${s.text}  ${a=="Все"?s.text_selected:""}`,children:["Все ",e.jsx("span",{className:`${s.circle} ${a=="Все"?s.circle_selected:""}`,children:c})]}),e.jsxs("p",{onClick:()=>d(n.Expectation),className:`${s.text} ${a==n.Expectation?s.text_selected:""}`,children:["Новые ",e.jsx("span",{className:`${s.circle} ${a==n.Expectation?s.circle_selected:""}`,children:l})]}),e.jsxs("p",{onClick:()=>d(n.InProgress),className:`${s.text} ${a==n.InProgress?s.text_selected:""}`,children:["В работе ",e.jsx("span",{className:`${s.circle} ${a==n.InProgress?s.circle_selected:""}`,children:r})]}),e.jsxs("p",{onClick:()=>d(n.Completed),className:`${s.text} ${a==n.Completed?s.text_selected:""}`,children:["Закрытые ",e.jsx("span",{className:`${s.circle} ${a==n.Completed?s.circle_selected:""}`,children:u})]})]}),ae=({selectedStatus:c,onStatusChange:l,sortBy:r,onSortChange:u,searchQuery:a,onSearchChange:d,counts:i})=>e.jsxs("div",{className:R.sorted_container,children:[e.jsx(K,{value:a,onChange:d}),e.jsx(Y,{selected:r,onChange:u}),e.jsx(ne,{selected:c,onSelect:l,all:i.all,closed:i.closed,inProgress:i.inProgress,newCount:i.new})]}),ie=()=>{const[c,l]=o.useState("Все"),[r,u]=o.useState("date"),[a,d]=o.useState(""),[i,y]=o.useState([]),[j,T]=o.useState(null),N=o.useMemo(()=>new I,[]),$=o.useMemo(()=>new E,[]);o.useEffect(()=>{$.getMe().then(t=>T(t))},[$]),o.useEffect(()=>{j&&N.getTickets({status:"Все"}).then(t=>{y(t.items)})},[j,N]);const w=o.useMemo(()=>i.reduce((t,x)=>{switch(x.ticket.status){case n.Expectation:t.new+=1;break;case n.InProgress:t.inProgress+=1;break;case n.Completed:t.closed+=1;break}return t.all+=1,t},{all:0,new:0,inProgress:0,closed:0}),[i]),S=o.useMemo(()=>{const t=i.filter(_=>c==="Все"?!0:_.ticket.status===c),x=a.trim().toLowerCase(),h=x?t.filter(_=>{const p=_.ticket.name.toLowerCase(),g=_.ticket.description.toLowerCase();return p.includes(x)||g.includes(x)}):t;if(r==="status"){const _={[n.Expectation]:0,[n.InProgress]:1,[n.Completed]:2};return[...h].sort((p,g)=>{const f=_[p.ticket.status]-_[g.ticket.status];return f!==0?f:new Date(g.ticket.createdTime).getTime()-new Date(p.ticket.createdTime).getTime()})}return[...h].sort((_,p)=>new Date(p.ticket.createdTime).getTime()-new Date(_.ticket.createdTime).getTime())},[a,c,r,i]),v=t=>{l(t)},b=o.useCallback(t=>{y(x=>x.map(h=>h.ticket.id===t.id?{...h,ticket:t}:h))},[]);return e.jsxs("div",{className:m.main_container,children:[e.jsxs("p",{className:m.name,children:["Добро пожаловать,",e.jsx("br",{}),e.jsx("span",{className:m.name_gradient,children:j?.fullName||"..."})]}),e.jsx("p",{className:m.ticket_status,children:"Сильный не тот, кто судит, а тот, кто помогает"}),e.jsx(P,{counts:w}),e.jsx(ae,{counts:w,sortBy:r,onSortChange:u,onStatusChange:v,selectedStatus:c,searchQuery:a,onSearchChange:d}),e.jsxs("div",{className:m.ticket_list_name,children:[e.jsxs("p",{className:m.ticket_name,children:["Тикеты",c!=="Все"&&e.jsxs("span",{className:m.color_grey,children:["• ",c]})]}),e.jsxs("p",{className:m.ticket_count,children:[S.length," из ",i.length]})]}),j&&e.jsx(A,{list:S,mode:"admin",onTicketUpdated:b})]})};export{ie as default};
