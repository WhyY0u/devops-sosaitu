import{r as a,j as e,i as b,U as f}from"./index-CKLftP6T.js";import{C as y,a as S,T as k}from"./TicketList-Uvjy3bVV.js";const C="_main_container_1v3qz_1",z="_name_1v3qz_5",T="_name_gradient_1v3qz_13",E="_ticket_status_1v3qz_19",j={main_container:C,name:z,name_gradient:T,ticket_status:E},L="_container_create_ticket_1vz84_1",I="_plus_1vz84_10",R="_title_container_1vz84_25",$="_create_ticket_label_1vz84_31",D="_label_1vz84_37",P="_label_text_1vz84_43",U="_input_1vz84_50",q="_textarea_1vz84_65",B="_button_1vz84_82",H="_counter_1vz84_113",t={container_create_ticket:L,plus:I,title_container:R,create_ticket_label:$,label:D,label_text:P,input:U,textarea:q,button:B,counter:H},M="_dropdown_nm13e_1",O="_dropdownHeader_nm13e_7",A="_arrow_nm13e_24",F="_open_nm13e_28",V="_dropdownList_nm13e_32",G="_show_nm13e_47",J="_dropdownItem_nm13e_53",m={dropdown:M,dropdownHeader:O,arrow:A,open:F,dropdownList:V,show:G,dropdownItem:J},K=({options:d,placeholder:c="Выберите...",onSelect:s})=>{const[r,o]=a.useState(!1),[p,h]=a.useState(""),l=a.useRef(null),w=()=>o(!r),_=n=>{h(n),s(n),o(!1)};return a.useEffect(()=>{const n=u=>{l.current&&!l.current.contains(u.target)&&o(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]),e.jsxs("div",{className:m.dropdown,ref:l,children:[e.jsxs("div",{className:m.dropdownHeader,onClick:w,children:[e.jsx("span",{children:p||c}),e.jsx("span",{className:`${m.arrow} ${r?m.open:""}`,children:"▼"})]}),e.jsx("ul",{className:`${m.dropdownList} ${r?m.show:""}`,children:d.map((n,u)=>e.jsx("li",{className:m.dropdownItem,onClick:()=>_(n),children:n},u))})]})};class N{async getTickets(c,s){return(await b.get("/user/tickets",{params:{status:s?.status,sortBy:s?.sortBy}})).data}async createTicket(c,s){if(!c)throw new Error("User is required");await b.post("/user/createTicket",{name:s.title,description:s.description,type:s.category})}async getTicketById(c){throw new Error("Method not implemented.")}async updateTicket(c){throw new Error("Method not implemented.")}}const Q=({user:d})=>{const[c,s]=a.useState(""),[r,o]=a.useState(""),[p,h]=a.useState(""),[l,w]=a.useState(!1),[_,n]=a.useState(null),[u,i]=a.useState(!1),g=c.trim().length>0&&r.trim().length>0&&p,v=async()=>{if(g){w(!0),n(null),i(!1);try{await new N().createTicket(d,{title:c,description:r,category:p}),i(!0),s(""),o(""),h("")}catch(x){n(x.message||"Произошла ошибка при создании тикета")}finally{w(!1)}}};return e.jsxs("div",{className:t.container_create_ticket,children:[e.jsxs("div",{className:t.title_container,children:[e.jsx("p",{className:t.plus,children:"+"}),e.jsx("p",{className:t.create_ticket_label,children:"Создать новый тикет"})]}),e.jsxs("label",{className:t.label,children:[e.jsx("p",{className:t.label_text,children:"Тема обращения"}),e.jsx("input",{className:t.input,placeholder:"Опишите кратко суть вопроса...",maxLength:30,value:c,onChange:x=>s(x.target.value)}),e.jsxs("span",{className:t.counter,children:[c.length,"/30"]})]}),e.jsxs("label",{className:t.label,children:[e.jsx("p",{className:t.label_text,children:"Подробное описание"}),e.jsx("textarea",{className:t.textarea,placeholder:"Расскажите подробнее о вашем вопросе или проблеме...",maxLength:1e3,value:r,onChange:x=>o(x.target.value)}),e.jsxs("span",{className:t.counter,children:[r.length,"/1000"]})]}),e.jsxs("label",{className:t.label,children:[e.jsx("p",{className:t.label_text,children:"Категория обращения"}),e.jsx(K,{options:d.groups,placeholder:"Выберите категорию...",onSelect:h})]}),_&&e.jsx("p",{className:t.error,children:_}),u&&e.jsx("p",{className:t.success,children:"Тикет успешно создан!"}),e.jsx("button",{className:t.button,disabled:!g||l,onClick:v,children:l?"Отправка...":"Отправить тикет"})]})},Y=()=>{const[d,c]=a.useState({all:0,new:0,inProgress:0,closed:0}),[s,r]=a.useState(null),[o,p]=a.useState([]),h=new N,l=new f;return a.useEffect(()=>{(async()=>{const _=await l.getMe();r(_);const n=await h.getTickets(_,{sortBy:"date",status:"Все"});p(n.items);const u=n.items.reduce((i,g)=>{switch(g.status){case k.Expectation:i.new+=1;break;case k.InProgress:i.inProgress+=1;break;case k.Completed:i.closed+=1;break}return i.all+=1,i},{all:0,new:0,inProgress:0,closed:0});c(u)})()},[]),e.jsxs("div",{className:j.main_container,children:[e.jsxs("p",{className:j.name,children:["Добро пожаловать,",e.jsx("br",{}),e.jsxs("span",{className:j.name_gradient,children:[s?.fullName,"!"]})]}),e.jsx("p",{className:j.ticket_status,children:"Создавайте тикеты и отслеживайте их статус"}),e.jsx(y,{counts:d}),s&&e.jsx(Q,{user:s}),s&&e.jsx(S,{list:o,mode:"user"})]})};export{Y as default};
