import{G as u,j as t,r as l,i as $,k as B,l as F,m as E,n as N,o as z}from"./index-CKLftP6T.js";function W(s){return u({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeMiterlimit:"10",strokeWidth:"32",d:"M416.07 272a160 160 0 1 0-160 160 160 160 0 0 0 160-160zM142.12 91.21A46.67 46.67 0 0 0 112 80l-2.79.08C83.66 81.62 64 104 64.07 131c0 13.21 4.66 19.37 10.88 27.23a4.55 4.55 0 0 0 3.24 1.77h.88a3.23 3.23 0 0 0 2.54-1.31L142.38 99a5.38 5.38 0 0 0 1.55-4 5.26 5.26 0 0 0-1.81-3.79zm227.76 0A46.67 46.67 0 0 1 400 80l2.79.08C428.34 81.62 448 104 447.93 131c0 13.21-4.66 19.37-10.88 27.23a4.55 4.55 0 0 1-3.24 1.76h-.88a3.23 3.23 0 0 1-2.54-1.31L369.62 99a5.38 5.38 0 0 1-1.55-4 5.26 5.26 0 0 1 1.81-3.79z"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256.07 160v112h-80m240 160-40-40m-280 40 40-40"},child:[]}]})(s)}function D(s){return u({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M262.29 192.31a64 64 0 1 0 57.4 57.4 64.13 64.13 0 0 0-57.4-57.4zM416.39 256a154.34 154.34 0 0 1-1.53 20.79l45.21 35.46a10.81 10.81 0 0 1 2.45 13.75l-42.77 74a10.81 10.81 0 0 1-13.14 4.59l-44.9-18.08a16.11 16.11 0 0 0-15.17 1.75A164.48 164.48 0 0 1 325 400.8a15.94 15.94 0 0 0-8.82 12.14l-6.73 47.89a11.08 11.08 0 0 1-10.68 9.17h-85.54a11.11 11.11 0 0 1-10.69-8.87l-6.72-47.82a16.07 16.07 0 0 0-9-12.22 155.3 155.3 0 0 1-21.46-12.57 16 16 0 0 0-15.11-1.71l-44.89 18.07a10.81 10.81 0 0 1-13.14-4.58l-42.77-74a10.8 10.8 0 0 1 2.45-13.75l38.21-30a16.05 16.05 0 0 0 6-14.08c-.36-4.17-.58-8.33-.58-12.5s.21-8.27.58-12.35a16 16 0 0 0-6.07-13.94l-38.19-30A10.81 10.81 0 0 1 49.48 186l42.77-74a10.81 10.81 0 0 1 13.14-4.59l44.9 18.08a16.11 16.11 0 0 0 15.17-1.75A164.48 164.48 0 0 1 187 111.2a15.94 15.94 0 0 0 8.82-12.14l6.73-47.89A11.08 11.08 0 0 1 213.23 42h85.54a11.11 11.11 0 0 1 10.69 8.87l6.72 47.82a16.07 16.07 0 0 0 9 12.22 155.3 155.3 0 0 1 21.46 12.57 16 16 0 0 0 15.11 1.71l44.89-18.07a10.81 10.81 0 0 1 13.14 4.58l42.77 74a10.8 10.8 0 0 1-2.45 13.75l-38.21 30a16.05 16.05 0 0 0-6.05 14.08c.33 4.14.55 8.3.55 12.47z"},child:[]}]})(s)}function P(s){return u({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{fill:"none",strokeMiterlimit:"10",strokeWidth:"32",d:"M366.05 146a46.7 46.7 0 0 1-2.42-63.42 3.87 3.87 0 0 0-.22-5.26l-44.13-44.18a3.89 3.89 0 0 0-5.5 0l-70.34 70.34a23.62 23.62 0 0 0-5.71 9.24 23.66 23.66 0 0 1-14.95 15 23.7 23.7 0 0 0-9.25 5.71L33.14 313.78a3.89 3.89 0 0 0 0 5.5l44.13 44.13a3.87 3.87 0 0 0 5.26.22 46.69 46.69 0 0 1 65.84 65.84 3.87 3.87 0 0 0 .22 5.26l44.13 44.13a3.89 3.89 0 0 0 5.5 0l180.4-180.39a23.7 23.7 0 0 0 5.71-9.25 23.66 23.66 0 0 1 14.95-15 23.62 23.62 0 0 0 9.24-5.71l70.34-70.34a3.89 3.89 0 0 0 0-5.5l-44.13-44.13a3.87 3.87 0 0 0-5.26-.22 46.7 46.7 0 0 1-63.42-2.32z"},child:[]},{tag:"path",attr:{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"32",d:"m250.5 140.44-16.51-16.51m60.53 60.53-11.01-11m55.03 55.03-11-11.01m60.53 60.53-16.51-16.51"},child:[]}]})(s)}const Y="_ticketStat_jf3yd_1",O="_topRow_jf3yd_12",U="_iconWrapper_jf3yd_20",V="_count_jf3yd_28",G="_label_jf3yd_36",p={ticketStat:Y,topRow:O,iconWrapper:U,count:V,label:G},x=({icon:s,label:c,count:n})=>t.jsxs("div",{className:p.ticketStat,children:[t.jsxs("div",{className:p.topRow,children:[t.jsx("div",{className:p.iconWrapper,children:s}),t.jsx("p",{className:p.count,children:n})]}),t.jsx("p",{className:p.label,children:c})]});function H(s){return u({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M362.6 192.9L345 174.8c-.7-.8-1.8-1.2-2.8-1.2-1.1 0-2.1.4-2.8 1.2l-122 122.9-44.4-44.4c-.8-.8-1.8-1.2-2.8-1.2-1 0-2 .4-2.8 1.2l-17.8 17.8c-1.6 1.6-1.6 4.1 0 5.7l56 56c3.6 3.6 8 5.7 11.7 5.7 5.3 0 9.9-3.9 11.6-5.5h.1l133.7-134.4c1.4-1.7 1.4-4.2-.1-5.7z"},child:[]},{tag:"path",attr:{d:"M256 76c48.1 0 93.3 18.7 127.3 52.7S436 207.9 436 256s-18.7 93.3-52.7 127.3S304.1 436 256 436c-48.1 0-93.3-18.7-127.3-52.7S76 304.1 76 256s18.7-93.3 52.7-127.3S207.9 76 256 76m0-28C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z"},child:[]}]})(s)}function X(s){return u({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M235.4 172.2c0-11.4 9.3-19.9 20.5-19.9 11.4 0 20.7 8.5 20.7 19.9s-9.3 20-20.7 20c-11.2 0-20.5-8.6-20.5-20zm1.4 35.7H275V352h-38.2V207.9z"},child:[]},{tag:"path",attr:{d:"M256 76c48.1 0 93.3 18.7 127.3 52.7S436 207.9 436 256s-18.7 93.3-52.7 127.3S304.1 436 256 436c-48.1 0-93.3-18.7-127.3-52.7S76 304.1 76 256s18.7-93.3 52.7-127.3S207.9 76 256 76m0-28C141.1 48 48 141.1 48 256s93.1 208 208 208 208-93.1 208-208S370.9 48 256 48z"},child:[]}]})(s)}const J="_container_ticket_wtj3m_1",K={container_ticket:J},Dt=({counts:s})=>t.jsxs("div",{className:`${K.container_ticket}`,children:[t.jsx(x,{icon:t.jsx(P,{style:{color:"#6065fa",fontSize:"28px"}}),label:"Всего тикетов",count:s.all}),t.jsx(x,{icon:t.jsx(X,{style:{color:"#3b82f6",fontSize:"28px"}}),label:"Новые",count:s.new}),t.jsx(x,{icon:t.jsx(W,{style:{color:"#f97316",fontSize:"28px"}}),label:"В работе",count:s.inProgress}),t.jsx(x,{icon:t.jsx(H,{style:{color:"#22c55e",fontSize:"28px"}}),label:"Закрыте",count:s.inProgress})]}),b={Expectation:"Expectation",InProgress:"InProgress",Completed:"Completed"},Q="_ticket_list_container_5mrao_1",Z={ticket_list_container:Q},q="_ticket_container_1w21o_1",tt="_ticket_line_one_1w21o_11",et="_ticket_number_1w21o_16",st="_ticket_status_name_1w21o_30",at="_user_icon_1w21o_43",ct="_ticket_name_1w21o_50",nt="_display_1w21o_57",it="_ticket_creator_name_1w21o_61",ot="_ticket_icon_create_data_1w21o_67",lt="_ticket_create_data_1w21o_75",_t="_ticket_type_1w21o_81",rt="_ticket_type_settings_1w21o_87",mt="_description_text_1w21o_95",dt="_button_1w21o_103",ut="_button_icon_1w21o_117",pt="_input_wrapper_1w21o_121",ht="_input_with_icon_1w21o_129",xt="_message_input_1w21o_134",kt="_ticket_margin_1w21o_179",gt="_cancel_text_1w21o_185",jt="_send_message_1w21o_186",wt="_ai_comment_block_1w21o_224",ft="_ai_comment_header_1w21o_234",Nt="_ai_icon_1w21o_241",bt="_ai_title_1w21o_246",St="_ai_comment_text_1w21o_252",vt="_expand_button_1w21o_258",e={ticket_container:q,ticket_line_one:tt,ticket_number:et,ticket_status_name:st,user_icon:at,ticket_name:ct,display:nt,ticket_creator_name:it,ticket_icon_create_data:ot,ticket_create_data:lt,ticket_type:_t,ticket_type_settings:rt,description_text:mt,button:dt,button_icon:ut,input_wrapper:pt,input_with_icon:ht,message_input:xt,ticket_margin:kt,cancel_text:gt,send_message:jt,ai_comment_block:wt,ai_comment_header:ft,ai_icon:Nt,ai_title:bt,ai_comment_text:St,expand_button:vt},yt="_status_container_1po23_1",Ct="_current_status_1po23_6",$t="_status_list_1po23_13",zt="_status_item_1po23_19",Mt="_image_icon_1po23_35",Tt="_status_item_selected_1po23_38",d={status_container:yt,current_status:Ct,status_list:$t,status_item:zt,image_icon:Mt,status_item_selected:Tt};function Lt(s){return u({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"},child:[]},{tag:"path",attr:{d:"M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"},child:[]}]})(s)}function It(s){return u({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"},child:[]},{tag:"path",attr:{d:"M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"},child:[]}]})(s)}function Rt(s){return u({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M9.172 16.242 12 13.414l2.828 2.828 1.414-1.414L13.414 12l2.828-2.828-1.414-1.414L12 10.586 9.172 7.758 7.758 9.172 10.586 12l-2.828 2.828z"},child:[]},{tag:"path",attr:{d:"M12 22c5.514 0 10-4.486 10-10S17.514 2 12 2 2 6.486 2 12s4.486 10 10 10zm0-18c4.411 0 8 3.589 8 8s-3.589 8-8 8-8-3.589-8-8 3.589-8 8-8z"},child:[]}]})(s)}const M=[{value:b.Expectation,label:"Новый",icon:t.jsx(Lt,{className:`${d.image_icon}`,size:19})},{value:b.InProgress,label:"В работе",icon:t.jsx(It,{className:`${d.image_icon}`,size:19})},{value:b.Completed,label:"Закрыт",icon:t.jsx(Rt,{className:`${d.image_icon}`,size:19})}],At=({ticket:s,onUpdate:c})=>{const[n,_]=l.useState(s.status),a=M.find(i=>i.value===n)?.label??n;return l.useEffect(()=>{_(s.status)},[s.status]),l.useEffect(()=>{n!==s.status&&c(n)},[c,n,s.status]),t.jsxs("div",{className:d.status_container,children:[t.jsxs("p",{className:d.current_status,children:["Текущий статус: ",a]}),t.jsx("div",{className:d.status_list,children:M.map(i=>t.jsxs("button",{onClick:()=>_(i.value),className:`${d.status_item} ${n===i.value?d.status_item_selected:""}`,children:[i.icon,t.jsx("span",{children:i.label})]},i.value))})]})};class Bt{async getTickets(c){return{items:(await $.get("/administator/tickets",{params:{status:c?.status,sortedStatus:c?.sortBy}})).data}}async updateTicket(c){await $.post("/administator/ticket",c)}}function Ft(s){const c=new Date(s),n=new Date,_=c.getFullYear()===n.getFullYear()&&c.getMonth()===n.getMonth()&&c.getDate()===n.getDate(),a=c.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});if(_)return`Сегодня в ${a}`;const i=c.getFullYear()===n.getFullYear(),o=c.toLocaleDateString("ru-RU",{day:"numeric",month:"long"});return i?`${o} в ${a}`:`${o} ${c.getFullYear()} г. в ${a}`}const Et=({user:s,ticket:c,mode:n="admin",onTicketUpdated:_})=>{const[a,i]=l.useState(c),[o,k]=l.useState(!1),[S,g]=l.useState(""),v=l.useRef(null),[j,T]=l.useState(!1),w=n==="admin",[h,y]=l.useState(!1),C=l.useMemo(()=>new Bt,[]);l.useEffect(()=>{i(c)},[c]);const L=r=>{const m=v.current;m&&(m.style.height="auto",m.style.height=`${m.scrollHeight}px`,g(r.target.value))},f=l.useCallback(async r=>{if(!w)return;const m={...a,status:r.status??a.status,comment:r.comment??a.comment};y(!0);try{await C.updateTicket({ticketId:a.id,status:m.status,comment:m.comment}),i(m),_?.(m)}catch(A){console.error("Ошибка обновления тикета администратора:",A)}finally{y(!1)}},[C,w,a,_]),I=l.useCallback(r=>{h||f({status:r})},[f,h]),R=async()=>{if(h)return;const r=S.trim();r&&(await f({comment:r}),g(""),k(!1))};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:`${e.ticket_container}`,children:[t.jsxs("div",{className:`${e.ticket_line_one}`,children:[t.jsxs("p",{className:`${e.ticket_number}`,children:["#",a.id]}),t.jsx("p",{className:`${e.ticket_status_name}`,children:a.status})]}),t.jsx("p",{className:`${e.ticket_name}`,children:a.name}),t.jsxs("div",{className:`${e.display}`,children:[t.jsx(B,{className:e.user_icon}),t.jsx("p",{className:`${e.ticket_creator_name}`,children:s.fullName}),t.jsx(F,{className:e.ticket_icon_create_data}),t.jsx("p",{className:`${e.ticket_create_data}`,children:Ft(c.createdTime)}),t.jsx(D,{className:e.ticket_type_settings}),t.jsx("p",{className:`${e.ticket_type}`,children:a.type})]}),t.jsx("p",{className:`${e.description_text}`,children:a.description}),t.jsx("button",{className:e.expand_button,onClick:()=>T(!j),children:j?"Свернуть детали":"Развернуть детали"}),j&&t.jsxs("div",{className:e.extra_content,children:[n==="admin"&&a.ai_comments.trim()&&t.jsxs("div",{className:e.ai_comment_block,children:[t.jsxs("div",{className:e.ai_comment_header,children:[t.jsx(E,{className:e.ai_icon}),t.jsx("span",{className:e.ai_title,children:"Комментарий от ИИ"})]}),t.jsx("p",{className:e.ai_comment_text,children:a.ai_comments})]}),n==="admin"&&a.comment&&t.jsxs("div",{className:e.ai_comment_block,children:[t.jsxs("div",{className:e.ai_comment_header,children:[t.jsx(N,{className:e.ai_icon}),t.jsx("span",{className:e.ai_title,children:"Комментарий администратора"})]}),t.jsx("p",{className:e.ai_comment_text,children:a.comment})]}),n==="user"&&a.comment&&t.jsxs("div",{className:e.ai_comment_block,children:[t.jsxs("div",{className:e.ai_comment_header,children:[t.jsx(N,{className:e.ai_icon}),t.jsx("span",{className:e.ai_title,children:"Ответ администратора"})]}),t.jsx("p",{className:e.ai_comment_text,children:a.comment})]}),w&&t.jsxs(t.Fragment,{children:[o?t.jsx("div",{className:e.input_wrapper,children:t.jsx("div",{className:e.input_with_icon,children:t.jsx("textarea",{ref:v,className:e.message_input,placeholder:"Введите сообщение...",value:S,onChange:L,rows:1})})}):t.jsxs("button",{className:e.button,onClick:()=>k(!0),children:[t.jsx(N,{className:e.button_icon}),"Написать сообщение"]}),o&&t.jsxs("div",{className:e.ticket_margin,style:{textAlign:"right"},children:[t.jsx("p",{className:e.send_message,onClick:R,children:h?"Сохранение...":"Отправить"}),t.jsx("p",{className:e.cancel_text,onClick:()=>{g(""),k(!1)},children:"Отмена"})]}),t.jsx(At,{onUpdate:I,ticket:a})]})]})]})})},Pt=({list:s,mode:c="admin",onTicketUpdated:n})=>{const[_,a]=z.useState([]);return z.useEffect(()=>{const i=s.map(o=>"ticket"in o&&"user"in o?o:{ticket:o,user:o.userCreate});a(i)},[s]),t.jsx("div",{className:Z.ticket_list_container,children:_.map(({ticket:i,user:o})=>t.jsx(Et,{ticket:i,user:o,mode:c,onTicketUpdated:n},i.id))})};export{Bt as A,Dt as C,b as T,Pt as a};
